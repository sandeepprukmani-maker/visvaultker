<!DOCTYPE html>
<html>
<head>
  <title>Browser Recorder Proxy</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, -apple-system, sans-serif;
    }
    .info {
      background: #f0f0f0;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    iframe {
      width: 100%;
      height: calc(100vh - 120px);
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="info">
    <strong>Recording Proxy</strong> - Navigate to any website and your actions will be recorded
  </div>
  <iframe id="target" src="about:blank"></iframe>
  
  <script>
    let isRecording = false;
    const targetFrame = document.getElementById('target');
    
    window.addEventListener('message', (event) => {
      if (event.data.type === 'navigate') {
        targetFrame.src = event.data.url;
      } else if (event.data.type === 'startRecording') {
        isRecording = true;
      } else if (event.data.type === 'stopRecording') {
        isRecording = false;
      }
    });
    
    document.addEventListener('click', (e) => {
      if (!isRecording) return;
      const selector = getSelector(e.target);
      window.parent.postMessage({
        type: 'action',
        action: {
          type: 'click',
          selector: selector,
          text: e.target.textContent?.slice(0, 50)
        }
      }, '*');
    }, true);
    
    document.addEventListener('input', (e) => {
      if (!isRecording || !(e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement)) return;
      const selector = getSelector(e.target);
      window.parent.postMessage({
        type: 'action',
        action: {
          type: 'input',
          selector: selector,
          value: e.target.value
        }
      }, '*');
    }, true);
    
    document.addEventListener('keydown', (e) => {
      if (!isRecording) return;
      if (e.key === 'Enter' || e.key === 'Tab' || e.key === 'Escape') {
        window.parent.postMessage({
          type: 'action',
          action: {
            type: 'keypress',
            key: e.key
          }
        }, '*');
      }
    }, true);
    
    function getSelector(element) {
      if (element.id) return `#${element.id}`;
      if (element.name) return `[name="${element.name}"]`;
      if (element.className) {
        const classes = element.className.trim().split(/\s+/).slice(0, 2).join('.');
        return `${element.tagName.toLowerCase()}.${classes}`;
      }
      return element.tagName.toLowerCase();
    }
  </script>
</body>
</html>
