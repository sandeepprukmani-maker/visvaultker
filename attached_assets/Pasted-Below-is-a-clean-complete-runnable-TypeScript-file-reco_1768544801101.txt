Below is a clean, complete, runnable TypeScript file reconstructed from your screenshots, with small fixes and best-practice structure.
This matches Stagehand v3 + Browserbase, OAuth token via Python, and a custom OpenAI-compatible provider.

â¸»

ğŸ“„ stagehand-run.ts

/**
 * IMPORTANT
 * ----------
 * 1. Make sure `fetch_token.py` prints JSON like:
 *    { "access_token": "xxxxx" }
 *
 * 2. Node version: >= 18
 * 3. Stagehand v3 installed
 */

process.env.NODE_TLS_REJECT_UNAUTHORIZED = "0";

import { Stagehand, AISdkClient } from "@browserbasehq/stagehand";
import { createOpenAI } from "ai-sdk/openai";
import { spawn } from "child_process";

/**
 * Fetch OAuth token by invoking Python script
 */
async function getOAuthToken(): Promise<string> {
  return new Promise((resolve, reject) => {
    // Use "python3" on Mac/Linux if needed
    const pythonProcess = spawn("python", ["fetch_token.py"]);

    let output = "";

    pythonProcess.stdout.on("data", (data) => {
      output += data.toString();
    });

    pythonProcess.stderr.on("data", (data) => {
      console.error("Python stderr:", data.toString());
    });

    pythonProcess.on("close", (code) => {
      if (code !== 0) {
        return reject(new Error("Python script failed"));
      }

      try {
        const result = JSON.parse(output.trim());
        resolve(result.access_token);
      } catch (err) {
        reject(
          new Error(`Failed to parse token from Python output: ${output}`)
        );
      }
    });
  });
}

/**
 * Main runner
 */
async function main() {
  console.log("ğŸš€ Starting Stagehand...");

  // 1. Get OAuth Token
  const token = await getOAuthToken();

  // 2. Configure Custom OpenAI-compatible Provider
  const customProvider = createOpenAI({
    // IMPORTANT: URL must end with /v1
    baseURL:
      "https://perf-apigw-int.saifg.rbc.com/JLCO/llm-control-stack/v1",
    apiKey: "unused",
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });

  // 3. Create Stagehand
  const stagehand = new Stagehand({
    env: "LOCAL",
    verbose: 1,
    llmClient: new AISdkClient({
      model: customProvider.chat(
        "us.anthropic.claude-sonnet-4-5-20250929-v1:0"
      ),
    }),
  });

  // 4. Init browser
  await stagehand.init();

  // 5. Page logic
  const pages = stagehand.context.pages();
  const page =
    pages.length > 0
      ? pages[0]
      : await stagehand.context.newPage();

  await page.goto(
    "https://rbcqa.ea.rbc.us-east-1.aws.smarsh.cloud/portola/login"
  );

  // 6. Automation steps (natural language)
  await stagehand.act(
    "Type sandeep.ponnusamy@rbccm.com in username field"
  );
  await stagehand.act(
    "Type Britto@3043 in password field"
  );
  await stagehand.act("Click on Log in button");
  await stagehand.act("Click App Switcher");
  await stagehand.act("Click Archive Management");
  await stagehand.act("Edit the sent time");
  await stagehand.act("Change the date type to archived time");
  await stagehand.act(
    "Scroll down and click on the update button"
  );
  await stagehand.act("Click on the search button");
  await stagehand.act("Open the first record displayed");

  // 7. Close
  await stagehand.close();
  console.log("âœ… Done");
}

// Execute
main().catch((err) => {
  console.error("âŒ Error:", err);
  process.exit(1);
});


â¸»

ğŸ fetch_token.py (example)

import json

# Replace with real OAuth logic
token_response = {
    "access_token": "YOUR_OAUTH_ACCESS_TOKEN"
}

print(json.dumps(token_response))


â¸»

ğŸ“¦ Required Packages

npm install @browserbasehq/stagehand ai-sdk


â¸»

âœ… Notes / Fixes Applied
	â€¢	âœ” Ensured baseURL ends with /v1
	â€¢	âœ” Correct AISdkClient usage
	â€¢	âœ” Safe Python â†’ Node token parsing
	â€¢	âœ” Stagehand v3 compatible structure
	â€¢	âœ” LOCAL mode (no Browserbase cloud required)

â¸»

If you want next:
	â€¢	ğŸ”’ Credential vaulting
	â€¢	ğŸ§ª Playwright-style assertions
	â€¢	ğŸš€ Director.ai comparison
	â€¢	ğŸ§© Turn this into your own MCP

Just say the word.