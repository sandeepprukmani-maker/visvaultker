Perfect ğŸ‘ Having the .pem file actually makes this cleaner.
Below is the EASIEST, COPY-PASTE, STEP-BY-STEP guide specifically for PEM key auth.

No assumptions. No skipped steps.

â¸»

Goal (with PEM key)

Use your local laptop â†’ SSH tunnel â†’ Azure VM (whitelisted IP) â†’ UWM APIs

â¸»

What you already have âœ…
	â€¢	Azure VM Public IP
	â€¢	.pem file (SSH private key)
	â€¢	VM username (example: azureuser)
	â€¢	VM can access UWM (already whitelisted)

â¸»

STEP 1: Place PEM file correctly

Move your .pem file to a safe folder.

Mac / Linux:

mkdir -p ~/.ssh
mv mykey.pem ~/.ssh/

Windows:
	â€¢	Put it inside:

C:\Users\<your-username>\.ssh\


â¸»

STEP 2: Set correct permission (VERY IMPORTANT)

Mac / Linux:

chmod 400 ~/.ssh/mykey.pem

âŒ If you skip this â†’ SSH will fail

Windows (Git Bash):

chmod 400 ~/.ssh/mykey.pem


â¸»

STEP 3: Test SSH login using PEM

Run this from your laptop:

ssh -i ~/.ssh/mykey.pem azureuser@<VM_PUBLIC_IP>

Example:

ssh -i ~/.ssh/mykey.pem azureuser@20.204.xx.xx

âœ” If you log in â†’ type exit and continue
âŒ If not â†’ stop here (donâ€™t tunnel yet)

â¸»

STEP 4: Create SSH Tunnel using PEM (MAIN STEP)

Now create the tunnel ğŸ‘‡

ssh -i ~/.ssh/mykey.pem \
-L 9000:uwm.internal.api:443 \
azureuser@<VM_PUBLIC_IP>

âš ï¸ Do NOT close this terminal

â¸»

STEP 5: Verify tunnel is working

Open browser or Postman and hit:

https://localhost:9000

If itâ€™s HTTPS and internal:
	â€¢	You may see cert warning â†’ ignore for local
	â€¢	Or youâ€™ll get API response

âœ” Tunnel works

â¸»

STEP 6: Call from your LOCAL application

Python example:

import requests

url = "https://localhost:9000/api/v1/loan"

res = requests.get(url, verify=False)
print(res.status_code)
print(res.text)


â¸»

STEP 7: Run flow (correct order)

Terminal 1 (Tunnel â€“ KEEP OPEN):

ssh -i ~/.ssh/mykey.pem -L 9000:uwm.internal.api:443 azureuser@<VM_PUBLIC_IP>

Terminal 2 (App):

python app.py


â¸»

OPTIONAL (Cleaner Command â€“ Save Time)

Create SSH config so you donâ€™t type long commands.

Edit:

nano ~/.ssh/config

Add:

Host azure-uwm
    HostName <VM_PUBLIC_IP>
    User azureuser
    IdentityFile ~/.ssh/mykey.pem

Now tunnel with:

ssh azure-uwm -L 9000:uwm.internal.api:443

ğŸ”¥ Much cleaner

â¸»

COMMON ERRORS & FIXES

âŒ â€œPermissions too openâ€

âœ” Fix:

chmod 400 ~/.ssh/mykey.pem


â¸»

âŒ â€œConnection timed outâ€

âœ” Check:
	â€¢	VM Public IP correct?
	â€¢	Port 22 allowed in NSG?

â¸»

âŒ â€œConnection refusedâ€

âœ” Means:
	â€¢	UWM API host/port wrong
	â€¢	Try testing inside VM first:

curl https://uwm.internal.api


â¸»

ONE-LINE SUMMARY

PEM file + SSH tunnel = your laptop behaves like Azure IP

â¸»